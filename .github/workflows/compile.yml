name: Build & Test

on: [push, pull_request]
  
jobs:
  build:

    runs-on: self-hosted
  
    defaults:
      run:
        working-directory: ./src
    
    outputs:
      semver: ${{ steps.gitversion.outputs.semver }}
      LicenseClearingTool: ${{ steps.packageBuildResults.outputs.LicenseClearingTool }}
        
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - uses: nuget/setup-nuget@v1
      with:
        nuget-version: '5.x'
    
     
    - name: Determine Version
      uses: gittools/actions/gitversion/execute@v0.9.7
      env: 
        ACTIONS_ALLOW_UNSECURE_COMMANDS: TRUE

    - name: Display SemVer
      run: |
        echo "SemVer: $($GITVERSION_SEMVER)" 
     
    - name: Gitversion
      id: gitversion
      run: |
        dotnet tool install --global GitVersion.Tool --version 5.3.6
        dotnet gitversion /output buildserver /nofetch
        echo %GITVERSION_SEMVER%
        echo "SemVer: $GITVERSION_SEMVER"
        echo "SemVer: $GitVersion_SemVer" 
        echo "SemVer: $($GitVersion_SemVer)"
        Write-Host "version is: $($env:GitVersion_SemVer)"
        Write-Host "::set-output name=semver::$($env:GitVersion_SemVer)"

        dotnet gitversion /output file /outputfile version.json
        echo %GITVERSION_SEMVER%
        echo "SemVer: $GITVERSION_SEMVER"
        echo "SemVer: $GitVersion_SemVer" 
        echo "SemVer: $($GitVersion_SemVer)"
        Write-Host "version is: $($env:GitVersion_SemVer)"
        Write-Host "::set-output name=semver::$($env:GitVersion_SemVer)"
        Write-Host "$semver"
      env: 
        ACTIONS_ALLOW_UNSECURE_COMMANDS: TRUE
     
     
  
